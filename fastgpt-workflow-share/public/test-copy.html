<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试复制功能</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            max-height: 300px;
        }
    </style>
</head>
<body>
    <h1>复制功能测试</h1>
    
    <div class="test-section">
        <h2>测试1: 基本复制功能</h2>
        <p>测试简单文本复制</p>
        <button onclick="testBasicCopy()">复制简单文本</button>
        <div id="basic-result"></div>
    </div>
    
    <div class="test-section">
        <h2>测试2: JSON对象复制</h2>
        <p>测试复杂JSON对象复制</p>
        <button onclick="testJsonCopy()">复制JSON对象</button>
        <div id="json-result"></div>
        <pre id="json-content"></pre>
    </div>
    
    <div class="test-section">
        <h2>测试3: FastGPT配置复制</h2>
        <p>测试FastGPT工作流配置复制</p>
        <button onclick="testWorkflowCopy()">复制工作流配置</button>
        <div id="workflow-result"></div>
        <pre id="workflow-content"></pre>
    </div>
    
    <div class="test-section">
        <h2>测试4: API数据复制</h2>
        <p>从API获取真实数据并测试复制</p>
        <button onclick="testApiCopy()">获取并复制API数据</button>
        <div id="api-result"></div>
        <pre id="api-content"></pre>
    </div>

    <script>
        // 测试基本复制功能
        async function testBasicCopy() {
            const text = "Hello, World! 这是一个测试文本。";
            const resultDiv = document.getElementById('basic-result');
            
            try {
                await navigator.clipboard.writeText(text);
                resultDiv.innerHTML = '<span class="success">✅ 基本复制成功</span>';
            } catch (err) {
                resultDiv.innerHTML = `<span class="error">❌ 基本复制失败: ${err.message}</span>`;
            }
        }
        
        // 测试JSON对象复制
        async function testJsonCopy() {
            const jsonObj = {
                name: "测试对象",
                value: 123,
                array: [1, 2, 3],
                nested: {
                    key: "value",
                    chinese: "中文测试"
                }
            };
            
            const jsonString = JSON.stringify(jsonObj, null, 2);
            const resultDiv = document.getElementById('json-result');
            const contentDiv = document.getElementById('json-content');
            
            contentDiv.textContent = jsonString;
            
            try {
                await navigator.clipboard.writeText(jsonString);
                resultDiv.innerHTML = '<span class="success">✅ JSON复制成功</span>';
            } catch (err) {
                resultDiv.innerHTML = `<span class="error">❌ JSON复制失败: ${err.message}</span>`;
            }
        }
        
        // 测试FastGPT工作流配置复制
        async function testWorkflowCopy() {
            const workflowConfig = {
                nodes: [
                    {
                        id: 'start',
                        type: 'start',
                        position: { x: 100, y: 100 },
                        data: { label: '开始' }
                    },
                    {
                        id: 'claude4-chat',
                        type: 'ai-chat',
                        position: { x: 300, y: 100 },
                        data: {
                            model: 'claude-3-5-sonnet-20241022',
                            systemPrompt: '你是Claude4，一个强大的AI助手。',
                            maxToken: 4000,
                            temperature: 0.7
                        }
                    }
                ],
                edges: [
                    {
                        id: 'start-to-claude',
                        source: 'start',
                        target: 'claude4-chat'
                    }
                ],
                variables: [
                    {
                        id: 'user_input',
                        name: '用户输入',
                        type: 'string'
                    }
                ],
                version: '1.0'
            };
            
            const configString = JSON.stringify(workflowConfig, null, 2);
            const resultDiv = document.getElementById('workflow-result');
            const contentDiv = document.getElementById('workflow-content');
            
            contentDiv.textContent = configString;
            
            try {
                await navigator.clipboard.writeText(configString);
                resultDiv.innerHTML = '<span class="success">✅ 工作流配置复制成功</span>';
            } catch (err) {
                resultDiv.innerHTML = `<span class="error">❌ 工作流配置复制失败: ${err.message}</span>`;
            }
        }
        
        // 测试API数据复制
        async function testApiCopy() {
            const resultDiv = document.getElementById('api-result');
            const contentDiv = document.getElementById('api-content');
            
            try {
                resultDiv.innerHTML = '⏳ 正在获取API数据...';
                
                const response = await fetch('http://localhost:3001/api/workflows/claude4-assistant');
                const data = await response.json();
                
                if (data.success && data.data && data.data.config) {
                    const configString = JSON.stringify(data.data.config, null, 2);
                    contentDiv.textContent = configString;
                    
                    await navigator.clipboard.writeText(configString);
                    resultDiv.innerHTML = '<span class="success">✅ API数据复制成功</span>';
                } else {
                    resultDiv.innerHTML = `<span class="error">❌ API数据无效: ${JSON.stringify(data)}</span>`;
                }
            } catch (err) {
                resultDiv.innerHTML = `<span class="error">❌ API数据复制失败: ${err.message}</span>`;
                console.error('API测试错误:', err);
            }
        }
        
        // 页面加载时的初始化
        window.addEventListener('load', function() {
            console.log('复制功能测试页面已加载');
            
            // 检查clipboard API支持
            if (!navigator.clipboard) {
                document.body.insertAdjacentHTML('afterbegin', 
                    '<div style="background: #ffebee; color: #c62828; padding: 15px; margin-bottom: 20px; border-radius: 4px;">' +
                    '⚠️ 警告: 当前浏览器不支持Clipboard API，或者页面不是通过HTTPS访问' +
                    '</div>'
                );
            }
        });
    </script>
</body>
</html>